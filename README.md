# Kotlin-Swift interopedia

Мы создали этот репозиторий, чтобы помочь разработчикам, интересующимся технологией KMM, понять, 
как будет выглядеть описанное ими публичное API общего модуля.

В сети есть [подробная документация от JetBrains](https://kotlinlang.org/docs/native-objc-interop.html)   
про интероп между Kotlin и Swift, однако в ней не рассматриваются подробно все возможности языка Kotlin.   
Поэтому мы свели в единую табличку перечень возможностей Kotlin-а и отметили, какими возможностями можно  
пользоваться без каких-либо проблем, а с какими потребуются те или иные доработки.

## Таблица интеропа

Как пользоваться таблицей:

- Знак :white_check_mark: означает, что указанной фичой Kotlin-а можно спокойно пользоваться,
она генерирует Swift-friendly код без необходимости доработок;
- Знак :warning: означает, что либо для работы фичи требуются какие-то доработки, либо есть несоответствие между 
ожидаемым и реальным поведением фичи, которое не сильно мешает разработке;
- Знак :no_entry_sign: означает, что фичой нельзя пользоваться, она генерирует не Swift-friendly код, она работает 
совсем не так как ожидается, и это может стать помехой в разработке.

<br/>

| Фича Kotlin-а                                                 | Ожидание                                                                                               | Реальность         | Комментарий                                                                                                                                                                |
| ------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Internal-модификатор](/docs/01%20-%20Internal%20modifier.md) | Internal-функции и классы не видны в Swift                                                             | :white_check_mark: | Нужно будет обсуждать только публичное API нашего SDK                                                                                                                      |
| [Java Doc comments](/docs/02%20-%20JavaDoc%20comments.md)     | Комментарии видны в XCode                                                                              | :warning:          | В целом всё ок. При автодополнении для классов и методов видно комментарии из JavaDoc-а. При переходе к определению функции можно увидеть комментарии для @param / @return |
| Top-level properties                                          | Можно вызвать из кода напрямую после импорта: propertyVal, propertyVar, simpleFunction()               | :warning:          | Появляется обёртка со статическими членами: UtilityKt.propertyVal                                                                                                          |
| Top-level functions                                           |                                                                                                        |                    |                                                                                                                                                                            |
| Extension properties over usual classes                       | Можно вызывать на объекте класса, myClass.extensionProperty,                                           | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Extension functions over usual class                          | Можно вызывать на объекте класса, myClass.extensionFunc()                                              | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Extension properties over platform class                      | Можно вызывать на объекте платформенного класса, "123".extensionProperty                               | :warning:          | Появляется обёртка со статическими членами: StringExtKt.extensionFunc("123")                                                                                                                                                                           |
| Extension function over platfrom class                        | Можно вызывать на объекте платформенного класса, "123".extensionFunc()                                 | :warning:          | Появляется обёртка со статическими членами: StringExtKt.extensionFunc("123")                                                                                               |
| Usual class constructor                                       | Можно сконструировать объект с указанием параметров                                                    | :white_check_mark: | Всё ок :thumbsup: Подсказки типов присутствуют. Int подсвечивается как Int32, Long - Int64                                                                                 |
| Usual class val                                               | Можно вызвать на объекте, myClass.myVal / поле readonly                                                | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Usual class var                                               | Можно вызвать на объекте, myClass.myVar / можно менять данные                                          | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Usual class function                                          | Можно вызвать на объекте, myClass.function()                                                           | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Default parameters in constructor                             | Можно вызвать конструктор, не указывая аргументы с дефолтными значениями, MyClass(param2 = 1)          | :no_entry_sign:    | Приходится указывать все параметры, даже те, которые имеют default-значения                                                                                                |
| Default parameters in function                                | Можно вызвать функцию, не указывая аргументы с дефолтными значениями, myDefaultFunc(param2 = 1)        | :no_entry_sign:    | Приходится указывать все параметры, даже те, которые имеют default-значения                                                                                                |
| Companion object in usual class                               | Можно вызвать свойство / функцию на классе , MyClass.compVal                                           | :warning:          | Появляется доп. объект Companion для класса , MyClass.companion.compVal                                                                                                    |
| Data class, copy                                              | Можно вызвать метод copy, чтобы получить копию                                                         | :warning:          | Появляется метод doCopy, который можно использовать для копирования, но в нём не работают default-аргументы --> надо указывать всё                                         |
| Data class, equals                                            | Можно сравнить 2 объекта data class по тем же правилам, что в java                                     | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Data class, toString                                          | Сгенерирован метод toString (или аналог), который выведет содержимое data class-а                      | :white_check_mark: | Всё ок :thumbsup: Появляется метод description(), который используется в интерполяции, работает корректно                                                                  |
| Data class, destructuring                                     | Можно написать конструкцию для destructuring и она работает ; (param1, param2) = myDataClass           | :no_entry_sign:    | Не работает как ожидается. Есть методы component1() / component2(), etc, но автоматически не работают в синтаксической конструкции                                         |
| Sealed class                                                  | Корректно конвертируется в структуру, которую можно передать в switch-конструкцию и сделать exhaustive | :no_entry_sign:    | Генерируется класс с наследниками. Передав в switch нет подсказок об exhaustive. Для Swift-а нужен enum.                                                                   |
| Abstract class                                                | Можно отнаследоваться, IDE подсказывает какие методы надо переопределить                               | :warning:          | Нет подсказок о методе для переопределения =/                                                                                                                              |
| Enum class                                                    | Kotlin-овский enum class превратится в enum Swift-а, и можно будет использовать switch                 | :no_entry_sign:    | Не работает как ожидается. Но сгенерировался объект со статическими элементами                                                                                             |
| Annotation class                                              | Аннотацию можно использовать и в Swift-коде                                                            | :no_entry_sign:    | Аннотация не была добавлена в .h-файл.                                                                                                                                     |
| Value class                                                   | Можно использовать как обычный класс                                                                   | :no_entry_sign:    | Value–класс не попал в .h-файл                                                                                                                                             |
| Function with value class argument                            | Функция появится в .h-файле и её можно будет использовать, передавая value-класс                       | :no_entry_sign:    | Функция появилась в .h-файле, но аргумент value-класса развернулся в примитивы                                                                                             |
| Open class                                                    | Можно наследоваться от open-класса, есть доступ к protected-полям, можно переопределять методы         | :warning:          | В целом всё ок, но есть нюансы.                                                                                                                                            |
| Inner class                                                   | Можно спокойно создать экземпляр inner-класса, аналогично синтаксису Kotlin-а                          | :warning:          | В целом всё ок, но есть отличия в синтаксисе от Kotlin-а                                                                                                                   |
| Objects                                                       | Объект - синглетон, синтаксис использования - как в Kotlin                                             | :warning:          | Если использовать shared - всё более-менее нормально                                                                                                                       |
| Interface                                                     | При реализации интерфейса, IDE подставит заглушки для всего                                            | :warning:          | В целом всё ок, интерфейс стал @protocol-ом. Но почему-то val-свойство превратилось в `var`                                                                                |
| Sealed interface                                              | При использовании в switch IDE поможет рассмотреть все варианты                                        | :no_entry_sign:    | Сгенерировались отдельные протоколы, не связанные между собой                                                                                                              |
| Fun interface                                                 | Можно более простым синтаксисом создать лямбду                                                         | :no_entry_sign:    | В Swift нельзя создать анонимный класс                                                                                                                                     |
| Functions: suspend                                            | Suspend-функции развернулись в удобную для Swift-конструкцию                                           | :warning:          | Транслируется в callback, экспериментально - в async / await                                                                                                               |
| Functions: no return type                                     | Функции, которые ничего не возвращают, можно спокойно вызвать                                          | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Functions: return primitive type                              | Функция, возвращающая примитивный тип, работает без ошибок                                             | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Functions: return lambda                                      | Функция, вернувшая лямбду, работает без крашей; лямбду можно вызвать                                   | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Functions: lambda argument                                    | Функция, принимающая в аргументах лямбду, нормально конвертируется в Swift                             | :white_check_mark: | Всё ок :thumbsup: Можно использовать именованный параметр, можно без него                                                                                                  |
| Functions: several lambdas                                    | Функция, принимающая несколько лямбд, нормально конвертируется в Swift                                 | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Functions: extension function in args                         | Можно вызвать фукнцию так же, как в Kotlin                                                             | :warning:          | Extension-функция превращается в лямбду с параметром                                                                                                                       |
| Functions: inline                                             | Инлайн-функции есть в .h-файле, их можно вызвать                                                       | :white_check_mark: | Всё ок :thumbsup: Нет понимания, действительно они инлайнятся или нет.                                                                                                     |
| Functions: overload with the same param name                  | Как и в kotlin-е можно просто вызвать функцию с разными аргументами, никаких изменений имён аргументов | :no_entry_sign:    | Для каждой последующей перегрузки метода у параметра добавляется нижнее подчёркивание к имени                                                                              |
| Functions: DSL                                                | Надеемся, что DSL в Kotlin-е превратится в DSL на Swift                                                | :warning:          | Сгенерировались функции с receiver-ами, выглядит не так удобно, как хотелось бы                                                                                            |
| Functions: vararg parameter                                   | vararg смапился в Swift-овый variardic и используется аналогично                                       | :no_entry_sign:    | Не работает так, как ожидается                                                                                                                                             |
| Types: primitives                                             | Передавать и получать данные из функций просто и не напряжно                                           | :warning:          | Не всё так просто, как хотелось бы. Проблемы на стыке Swift и Kotlin-а                                                                                                     |
| Types: Optional                                               | С nullable-типами легко работать, есть оператор ?.                                                     | :white_check_mark: | Всё ок :thumbsup: Каких-то серьёзных проблем не заметил                                                                                                                    |
| Types: Primitive collections                                  | Использование коллекций примитивов простое и удобное                                                   | :warning:          | Проблемы возникают на стыке примитивных типов Swift-а и Kotlin-а, всё больно                                                                                               |
| Types: Mutable / not mutable collections                      | Сигнатуры List / MutableList / etc имеют значение в Swift-мире и тоже регулируют мутабельность         | :warning:          | Работает не совсем так, как ожидалось                                                                                                                                      |
| Types: Not primitive collections                              | Использование коллекций с кастомными типами удобное                                                    | :white_check_mark: | Да, всё как ожидается                                                                                                                                                      |
| Types: Unit                                                   | Unit == void                                                                                           | :white_check_mark: | Всё ок :thumbsup:                                                                                                                                                          |
| Generics: simple function                                     | Обычная функция-generic позволяет принять аргумент любого типа                                         | :no_entry_sign:    | Не работает как ожидается                                                                                                                                                  |
| Generics: interface                                           | Можно реализовать протокол с generic-ом после перехода в Swift                                         | :no_entry_sign:    | Generic-и на интерфейсах не поддерживаются                                                                                                                                 |
| Generics: classes                                             | Сгенерируется класс с generic-ом, пользоваться можоно как в Kotlin                                     | :warning:          | Есть некоторые особенности использования типов                                                                                                                             |
| Generics: IN variance                                         | Сгенерируется generic со схожим поведением (контравариантный generic)                                  | :no_entry_sign:    | Не работает как ожидается, приходится использовать приведение типов                                                                                                        |
| Generics: OUT variance                                        | Сгенерируется generic со схожим поведением (ковариантный generic)                                      | :no_entry_sign:    | Не работает как ожидается, приходится использовать приведение типов                                                                                                        |
| Generics: STAR variance                                       | Сгенерируется generic со схожим поведением (in Nothing / out Any?)                                     | :no_entry_sign:    | Не работает как ожидается, приходится использовать приведение типов                                                                                                        |
| Generics: reified                                             | Функции с reified нормально вызываются из Swift + работают ожидаемым образом                           | :no_entry_sign:    | Бросает исключение                                                                                                                                                         |
| Generics: bounded                                             | Ограничение типа generic-а, объявленное в Kotlin, сработает и в Swift                                  | :no_entry_sign:    | Ограничение не сработало                                                                                                                                                   |
|                                                               |                                                                                                        |                    |                                                                                                                                                                            |
